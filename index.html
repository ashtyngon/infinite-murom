<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>–°–ª–∞—Ç–∏—Å–ª–∞—Ç 3000: –ü–ª–∞–º—è –ñ–µ–ª–∞–Ω–∏—è</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-glow: #FF00FF;
            --secondary-glow: #00FFFF;
            --text-color: #EAEAEA;
            --bg-color: #1a0a1f;
            --ui-bg: #2a1a2f;
            --bar-power: #ff4757;
            --bar-diplomacy: #3742fa;
            --bar-culture: #f1c40f;
            --bar-gold: #4cd137;
            --bar-lust: #e84393;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at 1px 1px, rgba(255, 255, 255, 0.08) 1px, transparent 0), 
                            radial-gradient(circle at 15px 15px, rgba(255, 255, 255, 0.04) 1px, transparent 0);
            background-size: 30px 30px;
            font-family: 'Russo One', sans-serif;
            color: var(--text-color);
            overflow: hidden;
            display: flex;
            justify-content: center;
        }
        .game-wrapper {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100%;
            max-width: 600px;
        }
        .game-header {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            padding: 10px 15px;
            width: 100%;
            z-index: 10;
            background: var(--bg-color);
            border-bottom: 1px solid var(--primary-glow);
        }
        .stat {
            text-align: center;
        }
        .stat .icon {
            font-size: 1.5rem;
            text-shadow: 0 0 5px var(--secondary-glow);
        }
        .bar-container {
            width: 100%;
            height: 6px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .bar {
            height: 100%;
            width: 50%;
            border-radius: 3px;
            transition: width 0.3s ease-in-out;
            box-shadow: 0 0 8px;
        }
        #stat-power .bar { background-color: var(--bar-power); box-shadow: 0 0 8px var(--bar-power); }
        #stat-diplomacy .bar { background-color: var(--bar-diplomacy); box-shadow: 0 0 8px var(--bar-diplomacy); }
        #stat-culture .bar { background-color: var(--bar-culture); box-shadow: 0 0 8px var(--bar-culture); }
        #stat-gold .bar { background-color: var(--bar-gold); box-shadow: 0 0 8px var(--bar-gold); }
        #stat-lust .bar { background-color: var(--bar-lust); box-shadow: 0 0 8px var(--bar-lust); }
        .chronicle-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px 15px;
            display: flex;
            flex-direction: column-reverse;
        }
        .chronicle-entry {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(42, 26, 47, 0.7);
            border: 1px solid var(--primary-glow);
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.2);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.5s ease forwards;
        }
        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }
        .entry-character {
            font-size: 1.1rem;
            color: var(--secondary-glow);
            margin-bottom: 10px;
        }
        .entry-text {
            font-size: 1rem;
            line-height: 1.6;
        }
        .entry-choice {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed var(--secondary-glow);
            color: var(--secondary-glow);
            font-style: italic;
        }
        .player-container {
            padding: 15px;
            border-top: 1px solid var(--primary-glow);
            background: var(--bg-color);
            z-index: 10;
        }
        .current-event {
            padding: 15px;
            background: var(--ui-bg);
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .audio-player {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .play-button {
            font-size: 1.5rem;
            margin-right: 15px;
            color: var(--primary-glow);
            cursor: default;
        }
        .progress-bar-container {
            flex-grow: 1;
            height: 8px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            border: 1px solid var(--primary-glow);
        }
        .progress-bar {
            width: 0;
            height: 100%;
            background: var(--primary-glow);
            border-radius: 4px;
        }
        .progress-bar.playing {
            animation: playAnimation 2s linear forwards;
        }
        @keyframes playAnimation {
            from { width: 0%; }
            to { width: 100%; }
        }
        .choices-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        .choice-btn {
            background: var(--ui-bg);
            border: 1px solid var(--secondary-glow);
            color: var(--secondary-glow);
            padding: 15px;
            font-family: 'Russo One', sans-serif;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s;
            text-align: left;
        }
        .choice-btn:hover {
            background-color: var(--primary-glow);
            color: var(--bg-color);
            box-shadow: 0 0 15px var(--primary-glow);
        }
        .hidden {
            display: none;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .modal.visible {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-content {
            background: var(--ui-bg);
            padding: 30px;
            border-radius: 20px;
            border: 2px solid var(--primary-glow);
            box-shadow: 0 0 30px var(--primary-glow);
            text-align: center;
            max-width: 90%;
            transform: scale(0.5);
            transition: transform 0.3s ease;
        }
        .modal.visible .modal-content {
            transform: scale(1);
        }
        .modal-title {
            font-size: 2.5rem;
            color: var(--primary-glow);
            margin-bottom: 15px;
        }
        .modal-text {
            font-size: 1.2rem;
            margin-bottom: 25px;
        }
        .restart-btn {
            background: linear-gradient(45deg, var(--primary-glow), var(--secondary-glow));
            color: var(--bg-color);
            border: none;
            padding: 15px 30px;
            font-family: 'Russo One', sans-serif;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: 0 0 15px var(--secondary-glow);
            transition: transform 0.2s;
        }
        .restart-btn:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <header class="game-header">
            <div class="stat" id="stat-power"><span class="icon" title="–°–∏–ª–∞">üí™</span><div class="bar-container"><div class="bar"></div></div></div>
            <div class="stat" id="stat-diplomacy"><span class="icon" title="–•–∏—Ç—Ä–æ—Å—Ç—å">üé≠</span><div class="bar-container"><div class="bar"></div></div></div>
            <div class="stat" id="stat-culture"><span class="icon" title="–ö—Ä—É—Ç–æ—Å—Ç—å">üé®</span><div class="bar-container"><div class="bar"></div></div></div>
            <div class="stat" id="stat-gold"><span class="icon" title="–ö–∞–∑–Ω–∞">üí∞</span><div class="bar-container"><div class="bar"></div></div></div>
            <div class="stat" id="stat-lust"><span class="icon" title="–°—Ç—Ä–∞—Å—Ç—å">üî•</span><div class="bar-container"><div class="bar"></div></div></div>
        </header>
        <main class="chronicle-container" id="chronicle-container"></main>
        <footer class="player-container" id="player-container">
            <div class="current-event">
                <div class="audio-player">
                    <div class="play-button">‚ñ∂</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                </div>
                <div class="entry-character" id="current-character"></div>
                <div class="entry-text" id="current-text"></div>
            </div>
            <div class="choices-container hidden" id="choices-container"></div>
        </footer>
    </div>
    <div class="modal" id="end-game-modal">
        <div class="modal-content">
            <h2 id="modal-title" class="modal-title">–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê</h2>
            <p id="modal-text" class="modal-text"></p>
            <button class="restart-btn" id="restart-btn">–ù–ê–ß–ê–¢–¨ –ó–ê–ù–û–í–û</button>
        </div>
    </div>
    <script>
        class AudioChronicleGame {
            constructor() {
                this.dom = {
                    stats: {
                        power: document.querySelector('#stat-power .bar'),
                        diplomacy: document.querySelector('#stat-diplomacy .bar'),
                        culture: document.querySelector('#stat-culture .bar'),
                        gold: document.querySelector('#stat-gold .bar'),
                        lust: document.querySelector('#stat-lust .bar'),
                    },
                    chronicle: document.getElementById('chronicle-container'),
                    player: {
                        container: document.getElementById('player-container'),
                        progressBar: document.getElementById('progress-bar'),
                        character: document.getElementById('current-character'),
                        text: document.getElementById('current-text'),
                        choices: document.getElementById('choices-container'),
                    },
                    modal: {
                        container: document.getElementById('end-game-modal'),
                        title: document.getElementById('modal-title'),
                        text: document.getElementById('modal-text'),
                        restartBtn: document.getElementById('restart-btn'),
                    }
                };
                this.dom.modal.restartBtn.addEventListener('click', () => this.startGame());
                this.story = this.defineStory();
            }

            defineStory() {
                return {
                    'start': {
                        character: "–õ–µ—Ç–æ–ø–∏—Å–µ—Ü",
                        text: "–ì–æ–¥ 912. –ú—É—Ä–æ–º—Å–∫–∏–µ –∑–µ–º–ª–∏ –∫–∏–ø—è—Ç —Ä–∞–∑–¥–æ—Ä–æ–º. –¢—ã ‚Äî –°–ª–∞—Ç–∏—Å–ª–∞—Ç, —Å—ã–Ω –≤–∞—Ä—è–≥–∞ –•–µ–ª—å–≥–∏—Ä–∞, –º–æ–ª–æ–¥–æ–π –∫–Ω—è–∑—å —Å –æ–≥–Ω–µ–º –≤ –≥—Ä—É–¥–∏. –¢–≤–æ—è –∫—Ä–æ–≤—å –ø—ã–ª–∞–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –∂–∞–∂–¥–æ–π –≤–ª–∞—Å—Ç–∏, –Ω–æ –∏ —Å—Ç—Ä–∞—Å—Ç—å—é, —á—Ç–æ —Ç—è–Ω–µ—Ç —Ç–µ–±—è –∫ —Å–∏–ª—å–Ω—ã–º –º—É–∂–∞–º —ç—Ç–∏—Ö –∑–µ–º–µ–ª—å. –ü—è—Ç—å –ø–ª–µ–º–µ–Ω –∂–¥—É—Ç —Ç–≤–æ–µ–≥–æ —Å–ª–æ–≤–∞. –ö–∞–∫ –Ω–∞—á–Ω–µ—à—å —Å–≤–æ–π –ø—É—Ç—å?",
                        choices: [{ text: "–°–ª—É—à–∞—Ç—å –±–∞—Ç—é –•–µ–ª—å–≥–∏—Ä–∞.", next: 'helgir_advice' }]
                    },
                    'helgir_advice': {
                        character: "–•–µ–ª—å–≥–∏—Ä, —Ç–≤–æ–π –æ—Ç–µ—Ü",
                        text: "–°—ã–Ω –º–æ–π, –°–ª–∞—Ç–∏—Å–ª–∞—Ç! –≠—Ç–∏ –∑–µ–º–ª–∏ ‚Äî —Ö–∞–æ—Å. –ü–ª–µ–º–µ–Ω–∞ —Ä–≤—É—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞, –∫–∞–∫ –≤–æ–ª–∫–∏. –¢—ã —Å–∏–ª–µ–Ω, –Ω–æ —Ç–≤–æ–∏ –≥–ª–∞–∑–∞ –≥–æ—Ä—è—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –∫ —Ç—Ä–æ–Ω—É. –Ø –≤–∏–∂—É, –∫–∞–∫ —Ç—ã —Å–º–æ—Ç—Ä–∏—à—å –Ω–∞ –≤–æ–∏–Ω–æ–≤ —É –∫–æ—Å—Ç—Ä–∞. –ë—É–¥—å –æ—Å—Ç–æ—Ä–æ–∂–µ–Ω ‚Äî —Å—Ç—Ä–∞—Å—Ç—å –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å —Ç–≤–æ–µ–π —Å–∏–ª–æ–π –∏–ª–∏ –≥–∏–±–µ–ª—å—é. –ß—Ç–æ –≤—ã–±–µ—Ä–µ—à—å: –º–µ—á –∏–ª–∏ —Ö–∏—Ç—Ä–æ—Å—Ç—å?",
                        choices: [
                            { text: "–ú–µ—á! –ü—É—Å—Ç—å –∫—Ä–æ–≤—å –≤—Ä–∞–≥–æ–≤ —É–∫—Ä–µ–ø–∏—Ç –º–æ–π —Ç—Ä–æ–Ω.", effects: { power: 20, diplomacy: -10 }, next: 'war_path_1' },
                            { text: "–•–∏—Ç—Ä–æ—Å—Ç—å. –Ø –∑–∞–≤–æ—é—é –∏—Ö —Å–µ—Ä–¥—Ü–∞, –∞ –Ω–µ –∑–µ–º–ª–∏.", effects: { diplomacy: 15, lust: 10 }, next: 'diplomacy_path_1' }
                        ]
                    },
                    'war_path_1': {
                        character: "–í–æ–µ–≤–æ–¥–∞ –°–≤–µ–Ω–µ–ª—å–¥",
                        text: "–ö–Ω—è–∑—å, —Ç–≤–æ—è –¥—Ä—É–∂–∏–Ω–∞ –≥–æ—Ç–æ–≤–∞ —Ä–∞–∑–æ—Ä–≤–∞—Ç—å –≤—Ä–∞–≥–æ–≤! –ù–æ —è –≤–∏–∂—É, –∫–∞–∫ —Ç—ã —Å–º–æ—Ç—Ä–∏—à—å –Ω–∞ –º–µ–Ω—è, –∫–æ–≥–¥–∞ —è —Å–Ω–∏–º–∞—é –¥–æ—Å–ø–µ—Ö–∏ —É —Ä–µ–∫–∏. –¢–≤–æ–µ —Å–µ—Ä–¥—Ü–µ –±—å–µ—Ç—Å—è –≥—Ä–æ–º—á–µ –±–∞—Ä–∞–±–∞–Ω–æ–≤ –≤–æ–π–Ω—ã. –ù–∞–∑–æ–≤–∏ —Ü–µ–ª—å: –º–µ—â–µ—Ä–∞ –∏–ª–∏ —Ä–∞–¥–∏–º–∏—á–∏?",
                        choices: [
                            { text: "–ú–µ—â–µ—Ä–∞. –ò—Ö –±–æ–≥–∞—Ç—Å—Ç–≤–∞ –º–æ–∏!", effects: { power: 15, gold: 20, diplomacy: -15 }, next: 'war_radogost' },
                            { text: "–†–∞–¥–∏–º–∏—á–∏. –°–ª–æ–º–ª—é —Å–ª–∞–±—ã—Ö –±—ã—Å—Ç—Ä–æ.", effects: { power: 20, diplomacy: -10 }, next: 'war_radogost' },
                            { text: "–°–≤–µ–Ω–µ–ª—å–¥, —Ç–≤–æ–π –≤–∑–≥–ª—è–¥... –†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ —É –∫–æ—Å—Ç—Ä–∞.", effects: { lust: 20, diplomacy: 10, power: -10 }, next: 'sveneld_romance' }
                        ]
                    },
                    'sveneld_romance': {
                        character: "–°–≤–µ–Ω–µ–ª—å–¥",
                        text: "–£ –∫–æ—Å—Ç—Ä–∞, –ø–æ–¥ –∑–≤–µ–∑–¥–∞–º–∏, –°–≤–µ–Ω–µ–ª—å–¥ –≥–æ–≤–æ—Ä–∏—Ç —Ç–∏—Ö–æ: '–ö–Ω—è–∑—å, —è –≤–∏–¥–µ–ª, –∫–∞–∫ —Ç—ã —Å–º–æ—Ç—Ä–∏—à—å. –ú–æ—è –≤–µ—Ä–Ω–æ—Å—Ç—å —Ç–≤–æ—è, –Ω–æ —ç—Ç–æ –æ–ø–∞—Å–Ω–æ. –ü–ª–µ–º–µ–Ω–∞ –Ω–µ –ø–æ–π–º—É—Ç. –•–æ—á–µ—à—å –º–µ–Ω—è ‚Äî –¥–æ–∫–∞–∂–∏, —á—Ç–æ —Ç–≤–æ–µ —Å–µ—Ä–¥—Ü–µ —Å–∏–ª—å–Ω–µ–µ –∏—Ö –ø—Ä–µ–¥—Ä–∞—Å—Å—É–¥–∫–æ–≤.'",
                        choices: [
                            { text: "–ü–æ—Ü–µ–ª–æ–≤–∞—Ç—å –µ–≥–æ, –ø–ª–µ–≤–∞—Ç—å –Ω–∞ —Å–ª—É—Ö–∏.", effects: { lust: 30, diplomacy: -20, culture: 10 }, action: () => this.gameState.flags.sveneldLoyalty = true, next: 'war_radogost' },
                            { text: "–û—Ç—Å—Ç—É–ø–∏—Ç—å. –í–æ–π–Ω–∞ –≤–∞–∂–Ω–µ–µ.", effects: { power: 10, lust: -10 }, next: 'war_radogost' }
                        ]
                    },
                    'diplomacy_path_1': {
                        character: "–õ–µ—Ç–æ–ø–∏—Å–µ—Ü",
                        text: "–¢—ã —Ä–µ—à–∏–ª –∑–∞–≤–æ–µ–≤–∞—Ç—å —Å–µ—Ä–¥—Ü–∞, –∞ –Ω–µ –∑–µ–º–ª–∏. –ì–æ–Ω—Ü—ã —Ä–∞–∑–æ—Å–ª–∞–Ω—ã, –∏ –º—É—Ä–æ–º—Å–∫–∏–µ —Å—Ç–∞—Ä–µ–π—à–∏–Ω—ã –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç –±—Ä–∞–∫ —Å –∏—Ö –¥–æ—á–µ—Ä—å—é. –ù–æ —Ç–≤–æ–µ —Å–µ—Ä–¥—Ü–µ —Ç—è–Ω–µ—Ç –Ω–µ –∫ –Ω–µ–π, –∞ –∫ –∏—Ö —Å—ã–Ω—É, –†–∞–¥–æ–≥–æ—Å—Ç—É, —á—å–∏ –≥–ª–∞–∑–∞ –æ–±–µ—â–∞—é—Ç –±–æ–ª—å—à–µ, —á–µ–º —Ç—Ä–æ–Ω.",
                        choices: [
                            { text: "–°–æ–≥–ª–∞—Å–∏—Ç—å—Å—è –Ω–∞ –±—Ä–∞–∫ —Ä–∞–¥–∏ —Å–æ—é–∑–∞.", effects: { diplomacy: 20, lust: -10 }, next: 'radogost_intro' },
                            { text: "–û—Ç–∫–∞–∑–∞—Ç—å—Å—è. –Ø —Ö–æ—á—É –†–∞–¥–æ–≥–æ—Å—Ç–∞.", effects: { lust: 20, diplomacy: -15, culture: 10 }, next: 'radogost_intro' }
                        ]
                    },
                    'radogost_intro': {
                        character: "–õ–µ—Ç–æ–ø–∏—Å–µ—Ü",
                        text: "–ù–∞ –ø–∏—Ä—É —Ç–≤–æ–∏ –≥–ª–∞–∑–∞ –ª–æ–≤—è—Ç –†–∞–¥–æ–≥–æ—Å—Ç–∞. –ï–≥–æ —Ç–µ–ª–æ, –æ–±–ª–∏—Ç–æ–µ —Å–≤–µ—Ç–æ–º —Ñ–∞–∫–µ–ª–æ–≤, –±—É–¥–∏—Ç –≤ —Ç–µ–±–µ –æ–≥–æ–Ω—å. –û–Ω –ø–æ–¥—Ö–æ–¥–∏—Ç –±–ª–∏–∂–µ, –µ–≥–æ –¥—ã—Ö–∞–Ω–∏–µ —Ç–µ–ø–ª–æ–µ, –≥–æ–ª–æ—Å –Ω–∏–∑–∫–∏–π: '–ö–Ω—è–∑—å, —è –Ω–µ –ø—Ä–æ—Å—Ç–æ –±–∞–Ω—â–∏–∫. –Ø –º–æ–≥—É –¥–∞—Ç—å —Ç–µ–±–µ –±–æ–ª—å—à–µ, —á–µ–º –∑–µ–º–ª–∏ ‚Äî –∑–Ω–∞–Ω–∏—è.'",
                        choices: [
                            { text: "–ü—Ä–∏—Ç—è–Ω—É—Ç—å –µ–≥–æ –±–ª–∏–∂–µ, —à–µ–ø–Ω—É—Ç—å –æ —Å–≤–æ–µ–º –∂–µ–ª–∞–Ω–∏–∏.", effects: { lust: 25, culture: 10, diplomacy: -10 }, action: () => this.gameState.flags.radogostLoyalty = true, next: 'radogost_talk_1' },
                            { text: "–°–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –µ–≥–æ —Å–ª–æ–≤–∞—Ö, –Ω–µ –Ω–∞ —Ç–µ–ª–µ.", effects: { culture: 15, lust: -5 }, next: 'radogost_talk_1' }
                        ]
                    },
                    'radogost_talk_1': {
                        character: "–†–∞–¥–æ–≥–æ—Å—Ç",
                        text: "–†–∞–¥–æ–≥–æ—Å—Ç —à–µ–ø—á–µ—Ç: '–Ø –∏–∑–æ–±—Ä–µ–ª –ø–∏—Å—å–º–µ–Ω–∞ –Ω–∞ –±–µ—Ä–µ—Å—Ç–µ. –≠—Ç–æ –∏–∑–º–µ–Ω–∏—Ç –ú—É—Ä–æ–º! –ù–æ, –∫–Ω—è–∑—å, —è –≤–∏–∂—É —Ç–≤–æ–π –≥–æ–ª–æ–¥. –•–æ—á–µ—à—å –º–µ–Ω—è, –Ω–æ –±–æ–∏—à—å—Å—è —Å—Ç–∞—Ä–µ–π—à–∏–Ω. –î–∞–π –º–Ω–µ —à–∞–Ω—Å ‚Äî –∏ —è –±—É–¥—É —Ç–≤–æ–∏–º –≤–æ –≤—Å–µ–º.'",
                        choices: [
                            { text: "–§–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∏–µ –∏ –≤–∑—è—Ç—å –µ–≥–æ –≤ –ø–æ–∫–æ–∏.", effects: { culture: 25, gold: -15, lust: 20 }, action: () => this.gameState.flags.writing = true, next: 'economy_1' },
                            { text: "–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø–∏—Å—å–º–µ–Ω–∞, –Ω–æ –¥–µ—Ä–∂–∞—Ç—å –¥–∏—Å—Ç–∞–Ω—Ü–∏—é.", effects: { culture: 20, gold: -10 }, action: () => this.gameState.flags.writing = true, next: 'economy_1' },
                            { text: "–û—Ç–≤–µ—Ä–≥–Ω—É—Ç—å –µ–≥–æ. –≠—Ç–æ —Å–ª–∏—à–∫–æ–º —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ.", effects: { culture: -15, diplomacy: 10 }, next: 'economy_1' }
                        ]
                    },
                    'war_radogost': {
                        character: "–õ–µ—Ç–æ–ø–∏—Å–µ—Ü",
                        text: "–¢–≤–æ—è –≤–æ–π–Ω–∞ –∏–¥–µ—Ç –ø–æ–ª–Ω—ã–º —Ö–æ–¥–æ–º, –Ω–æ –Ω–∞ –ø–∏—Ä—É —Ç—ã —Å–Ω–æ–≤–∞ –≤–∏–¥–∏—à—å –†–∞–¥–æ–≥–æ—Å—Ç–∞. –ï–≥–æ –≤–∑–≥–ª—è–¥ ‚Äî –∫–∞–∫ —Ä–∞—Å–∫–∞–ª–µ–Ω–Ω—ã–π —É–≥–æ–ª—å –Ω–∞ —Ç–≤–æ–µ–π –∫–æ–∂–µ. –û–Ω –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–∏—Å—å–º–µ–Ω–∞, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Ç–≤–æ–∏ –ø–æ–±–µ–¥—ã, –Ω–æ –µ–≥–æ –≥—É–±—ã –≥–æ–≤–æ—Ä—è—Ç –æ –¥—Ä—É–≥–æ–º.",
                        choices: [
                            { text: "–í–∑—è—Ç—å –µ–≥–æ –≤ —à–∞—Ç–µ—Ä, –ø—É—Å—Ç—å —Ä–∞—Å—Å–∫–∞–∂–µ—Ç –æ –ø–∏—Å—å–º–µ–Ω–∞—Ö —Ç–∞–º.", effects: { lust: 30, culture: 15, diplomacy: -15 }, action: () => this.gameState.flags.radogostLoyalty = true, next: 'radogost_talk_1' },
                            { text: "–°–ª—É—à–∞—Ç—å –æ –ø–∏—Å—å–º–µ–Ω–∞—Ö, –Ω–æ –Ω–µ –ø–æ–¥–¥–∞–≤–∞—Ç—å—Å—è —Å—Ç—Ä–∞—Å—Ç–∏.", effects: { culture: 20, lust: -10 }, next: 'radogost_talk_1' }
                        ]
                    },
                    'economy_1': {
                        character: "–ö–∞–∑–Ω–∞—á–µ–π",
                        text: "–ö–∞–∑–Ω–∞ —Ç—Ä–µ—â–∏—Ç, –∫–Ω—è–∑—å. –¢–≤–æ–∏ —Å—Ç—Ä–∞—Å—Ç–∏ –∏ –≤–æ–π–Ω—ã –¥–æ—Ä–æ–≥–æ –æ–±—Ö–æ–¥—è—Ç—Å—è. –í–≤–µ–¥–µ–º '–æ–∫—Å–∫–∏–π —Å–±–æ—Ä'? –ù–∞—Ä–æ–¥ —Ä–æ–ø—â–µ—Ç, –Ω–æ –±–µ–∑ –∑–æ–ª–æ—Ç–∞ —Ç—Ä–æ–Ω —Ä—É—Ö–Ω–µ—Ç.",
                        choices: [
                            { text: "–í–≤–µ—Å—Ç–∏ –Ω–∞–ª–æ–≥, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –≥–Ω–µ–≤ –Ω–∞—Ä–æ–¥–∞.", effects: { gold: 25, diplomacy: -20 }, next: 'betrayal_check' },
                            { text: "–û—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç –Ω–∞–ª–æ–≥–∞. –ù–∞–π–¥–µ–º –¥—Ä—É–≥–æ–π –ø—É—Ç—å.", effects: { diplomacy: 15, gold: -25 }, next: 'betrayal_check' }
                        ]
                    },
                    'betrayal_check': {
                        character: "–õ–µ—Ç–æ–ø–∏—Å–µ—Ü",
                        text: () => {
                            if (this.gameState.flags.sveneldLoyalty && this.gameState.flags.radogostLoyalty) {
                                return "–¢–≤–æ–∏ —Å–≤—è–∑–∏ —Å –†–∞–¥–æ–≥–æ—Å—Ç–æ–º –∏ –°–≤–µ–Ω–µ–ª—å–¥–æ–º —É–∫—Ä–µ–ø–∏–ª–∏ —Ç–≤–æ–µ —Å–µ—Ä–¥—Ü–µ, –Ω–æ –≤—ã–∑–≤–∞–ª–∏ —Ä–æ–ø–æ—Ç. –°—Ç–∞—Ä–µ–π—à–∏–Ω—ã –ø–ª–µ—Ç—É—Ç –∑–∞–≥–æ–≤–æ—Ä. –ö–∞–∫ –æ—Ç–≤–µ—Ç–∏—à—å?";
                            } else if (this.gameState.flags.sveneldLoyalty) {
                                return "–°–≤–µ–Ω–µ–ª—å–¥ –≤–µ—Ä–µ–Ω —Ç–µ–±–µ, –Ω–æ —Å–ª—É—Ö–∏ –æ —Ç–≤–æ–∏—Ö —Å—Ç—Ä–∞—Å—Ç—è—Ö —Ä–∞–∑–æ—à–ª–∏—Å—å. –°—Ç–∞—Ä–µ–π—à–∏–Ω—ã —Ç—Ä–µ–±—É—é—Ç —Å—É–¥–∞. –¢–≤–æ–π —Ö–æ–¥?";
                            } else if (this.gameState.flags.radogostLoyalty) {
                                return "–†–∞–¥–æ–≥–æ—Å—Ç –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç —Ç–µ–±—è, –Ω–æ –µ–≥–æ –±–ª–∏–∑–æ—Å—Ç—å –∫ —Ç–µ–±–µ —Ä–∞–∑–∂–∏–≥–∞–µ—Ç –≥–Ω–µ–≤ —Å—Ç–∞—Ä–µ–π—à–∏–Ω. –û–Ω–∏ –≥–æ—Ç–æ–≤—è—Ç –±—É–Ω—Ç. –ß—Ç–æ —Å–¥–µ–ª–∞–µ—à—å?";
                            } else {
                                return "–¢—ã –æ–¥–∏–Ω–æ–∫, –∫–Ω—è–∑—å. –ë–µ–∑ –≤–µ—Ä–Ω—ã—Ö —Å–µ—Ä–¥–µ—Ü —Å—Ç–∞—Ä–µ–π—à–∏–Ω—ã –≤–∏–¥—è—Ç –≤ —Ç–µ–±–µ —Å–ª–∞–±–æ—Å—Ç—å. –û–Ω–∏ –≥–æ—Ç–æ–≤—è—Ç –∑–∞–≥–æ–≤–æ—Ä. –¢–≤–æ–π –æ—Ç–≤–µ—Ç?";
                            }
                        },
                        choices: [
                            { text: "–°–æ–∑–≤–∞—Ç—å –ø–∏—Ä –∏ —É–±–µ–¥–∏—Ç—å —Å—Ç–∞—Ä–µ–π—à–∏–Ω —Ä–µ—á–∞–º–∏.", effects: { diplomacy: 20, gold: -15 }, next: 'end_diplomacy' },
                            { text: "–†–∞–∑–¥–∞–≤–∏—Ç—å –∑–∞–≥–æ–≤–æ—Ä —Å–∏–ª–æ–π!", effects: { power: 20, diplomacy: -20 }, next: 'end_war' },
                            { text: "–£–π—Ç–∏ –≤ –∏–∑–≥–Ω–∞–Ω–∏–µ —Å –†–∞–¥–æ–≥–æ—Å—Ç–æ–º –∏–ª–∏ –°–≤–µ–Ω–µ–ª—å–¥–æ–º.", effects: { lust: 30, power: -30, diplomacy: -20 }, next: 'end_exile' }
                        ]
                    },
                    'end_war': {
                        character: "–õ–µ—Ç–æ–ø–∏—Å–µ—Ü",
                        text: "–¢—ã –≤—ã—Ä–µ–∑–∞–ª –≤—Ä–∞–≥–æ–≤, –∫–∞–∫ –≤–æ–ª–∫ —Å—Ç–∞—é –æ–ª–µ–Ω–µ–π. –¢—Ä–æ–Ω —Ç–≤–æ–π, –Ω–æ –∫—Ä–æ–≤—å –∏ —Å—Ç—Ä–∞—Ö ‚Äî —Ç–≤–æ–∏ —Å–ø—É—Ç–Ω–∏–∫–∏. –ü–ª–µ–º–µ–Ω–∞ –ø–æ–∫–æ—Ä–µ–Ω—ã, –Ω–æ —Ç–≤–æ–µ —Å–µ—Ä–¥—Ü–µ –ø—É—Å—Ç–æ.",
                        ending: { title: "üëë –ñ–µ–ª–µ–∑–Ω—ã–π –ö–Ω—è–∑—å üëë", message: "–¢—ã –ø—Ä–∞–≤–∏–ª –º–µ—á–æ–º, –Ω–æ –ø–æ—Ç–µ—Ä—è–ª –ª—é–±–æ–≤—å. –¢–≤–æ–µ –∏–º—è ‚Äî —Å–∏–Ω–æ–Ω–∏–º —Å—Ç—Ä–∞—Ö–∞." }
                    },
                    'end_diplomacy': {
                        character: "–õ–µ—Ç–æ–ø–∏—Å–µ—Ü",
                        text: () => {
                            if (this.gameState.flags.radogostLoyalty) {
                                return "–¢–≤–æ–∏ —Ä–µ—á–∏ –∏ –†–∞–¥–æ–≥–æ—Å—Ç–æ–≤—ã –ø–∏—Å—å–º–µ–Ω–∞ —Å–ø–ª–æ—Ç–∏–ª–∏ –ø–ª–µ–º–µ–Ω–∞. –¢—ã ‚Äî –∫–Ω—è–∑—å, —á—å–µ —Å–µ—Ä–¥—Ü–µ –∏ —Ä–∞–∑—É–º –∏–∑–º–µ–Ω–∏–ª–∏ –ú—É—Ä–æ–º.";
                            } else {
                                return "–¢—ã —É–±–µ–¥–∏–ª —Å—Ç–∞—Ä–µ–π—à–∏–Ω, –Ω–æ –±–µ–∑ –ª—é–±–≤–∏ —Ç–≤–æ–µ –ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö–æ–ª–æ–¥–Ω–æ. –ú—É—Ä–æ–º –ø—Ä–æ—Ü–≤–µ—Ç–∞–µ—Ç, –Ω–æ —Ç—ã –æ–¥–∏–Ω–æ–∫.";
                            }
                        },
                        ending: { title: "üèÜ –ö–Ω—è–∑—å –°–µ—Ä–¥–µ—Ü üèÜ", message: "–¢—ã –æ–±—ä–µ–¥–∏–Ω–∏–ª –ú—É—Ä–æ–º —Ö–∏—Ç—Ä–æ—Å—Ç—å—é –∏ —Å—Ç—Ä–∞—Å—Ç—å—é. –¢–≤–æ—è –ª–µ–≥–µ–Ω–¥–∞ –Ω–∞—á–∞–ª–∞—Å—å." }
                    },
                    'end_exile': {
                        character: "–õ–µ—Ç–æ–ø–∏—Å–µ—Ü",
                        text: () => {
                            if (this.gameState.flags.radogostLoyalty && this.gameState.flags.sveneldLoyalty) {
                                return "–¢—ã –ø–æ–∫–∏–Ω—É–ª –ú—É—Ä–æ–º —Å –†–∞–¥–æ–≥–æ—Å—Ç–æ–º –∏ –°–≤–µ–Ω–µ–ª—å–¥–æ–º. –í–∞—à–∏ –Ω–æ—á–∏ –ø–æ–ª–Ω—ã —Å—Ç—Ä–∞—Å—Ç–∏, –Ω–æ —Ç—Ä–æ–Ω –ø–æ—Ç–µ—Ä—è–Ω –Ω–∞–≤—Å–µ–≥–¥–∞.";
                            } else if (this.gameState.flags.radogostLoyalty) {
                                return "–¢—ã –∏ –†–∞–¥–æ–≥–æ—Å—Ç –±–µ–∂–∞–ª–∏ –≤ –ª–µ—Å–∞. –ï–≥–æ –ª—é–±–æ–≤—å ‚Äî —Ç–≤–æ–π –Ω–æ–≤—ã–π —Ç—Ä–æ–Ω, –Ω–æ –ú—É—Ä–æ–º –∑–∞–±—ã–ª —Ç–µ–±—è.";
                            } else if (this.gameState.flags.sveneldLoyalty) {
                                return "–°–≤–µ–Ω–µ–ª—å–¥ —É—à–µ–ª —Å —Ç–æ–±–æ–π. –ï–≥–æ —Å–∏–ª–∞ ‚Äî —Ç–≤–æ—è –∑–∞—â–∏—Ç–∞, –Ω–æ –∑–µ–º–ª–∏ –ú—É—Ä–æ–º–∞ –æ—Å—Ç–∞–ª–∏—Å—å –ø–æ–∑–∞–¥–∏.";
                            } else {
                                return "–¢—ã –±–µ–∂–∞–ª –æ–¥–∏–Ω. –¢—Ä–æ–Ω –ø–æ—Ç–µ—Ä—è–Ω, —Å–µ—Ä–¥—Ü–µ —Ä–∞–∑–±–∏—Ç–æ.";
                            }
                        },
                        ending: { title: "üíî –ò–∑–≥–Ω–∞–Ω–Ω–∏–∫ üíî", message: "–¢—ã –≤—ã–±—Ä–∞–ª –ª—é–±–æ–≤—å, –Ω–æ –ø–æ—Ç–µ—Ä—è–ª –≤–ª–∞—Å—Ç—å. –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø–æ–º–Ω–∏—Ç —Ç–≤–æ–π –≤—ã–±–æ—Ä." }
                    }
                };
            }

            startGame() {
                this.dom.modal.container.classList.remove('visible');
                this.gameState = {
                    power: 50,
                    diplomacy: 50,
                    culture: 50,
                    gold: 50,
                    lust: 50,
                    turns: 0,
                    flags: {}
                };
                this.currentStoryNode = 'start';
                this.dom.chronicle.innerHTML = '';
                this.updateStatsUI();
                this.playNextEntry();
            }

            updateStatsUI() {
                Object.keys(this.dom.stats).forEach(stat => {
                    this.dom.stats[stat].style.width = `${this.gameState[stat]}%`;
                });
            }

            playNextEntry() {
                const entry = this.story[this.currentStoryNode];
                if (!entry) return;
                this.dom.player.character.textContent = entry.character;
                this.dom.player.text.textContent = typeof entry.text === 'function' ? entry.text() : entry.text;
                this.dom.player.choices.classList.add('hidden');
                this.dom.player.choices.innerHTML = '';
                this.dom.player.progressBar.classList.remove('playing');
                void this.dom.player.progressBar.offsetWidth;
                this.dom.player.progressBar.classList.add('playing');
                setTimeout(() => {
                    if (entry.ending) {
                        this.endGame(entry.ending.title, entry.ending.message);
                        return;
                    }
                    this.renderChoices(entry.choices);
                }, 2000);
            }

            renderChoices(choices) {
                this.dom.player.choices.classList.remove('hidden');
                choices.forEach(choice => {
                    const button = document.createElement('button');
                    button.className = 'choice-btn';
                    button.textContent = choice.text;
                    button.onclick = () => this.makeChoice(choice);
                    this.dom.player.choices.appendChild(button);
                });
            }

            makeChoice(choice) {
                const lastEntry = this.story[this.currentStoryNode];
                this.logToChronicle(lastEntry, choice.text);
                if (choice.effects) {
                    Object.keys(choice.effects).forEach(stat => {
                        this.gameState[stat] = Math.max(0, Math.min(100, this.gameState[stat] + choice.effects[stat]));
                    });
                }
                if (choice.action) choice.action();
                this.gameState.turns++;
                this.updateStatsUI();
                if (this.checkEndConditions()) return;
                this.currentStoryNode = choice.next;
                this.playNextEntry();
            }

            logToChronicle(entry, choiceText) {
                const logEntry = document.createElement('div');
                logEntry.className = 'chronicle-entry';
                logEntry.innerHTML = `
                    <div class="entry-character">${entry.character}</div>
                    <div class="entry-text">${typeof entry.text === 'function' ? entry.text() : entry.text}</div>
                    <div class="entry-choice">–í—ã —Ä–µ—à–∏–ª–∏: ${choiceText}</div>
                `;
                this.dom.chronicle.prepend(logEntry);
            }

            checkEndConditions() {
                if (this.gameState.power <= 0) {
                    this.endGame("‚ò†Ô∏è –ü–û–†–ê–ñ–ï–ù–ò–ï ‚ò†Ô∏è", "–¢–≤–æ—è –∞—Ä–º–∏—è —Ä–∞–∑–±–µ–∂–∞–ª–∞—Å—å, –≤—Ä–∞–≥–∏ —Å–æ–∂–≥–ª–∏ –ú—É—Ä–æ–º.");
                    return true;
                }
                if (this.gameState.diplomacy <= 0) {
                    this.endGame("üíî –ò–ó–ì–ù–ê–ù–ò–ï üíî", "–°—Ç–∞—Ä–µ–π—à–∏–Ω—ã –∏ –Ω–∞—Ä–æ–¥ –æ—Ç–≤–µ—Ä–≥–ª–∏ —Ç–µ–±—è.");
                    return true;
                }
                if (this.gameState.culture <= 0) {
                    this.endGame("üóø –ó–ê–ë–í–ï–ù–ò–ï üóø", "–¢–≤–æ–µ –ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–±—ã—Ç–æ, –∫–∞–∫ –ø—ã–ª—å –Ω–∞ –≤–µ—Ç—Ä—É.");
                    return true;
                }
                if (this.gameState.gold <= 0) {
                    this.endGame("üìâ –ë–ê–ù–ö–†–û–¢ üìâ", "–ö–∞–∑–Ω–∞ –ø—É—Å—Ç–∞, —Ç—Ä–æ–Ω —Ä—É—Ö–Ω—É–ª.");
                    return true;
                }
                if (this.gameState.lust >= 100) {
                    this.endGame("üî• –ü–õ–ê–ú–Ø –°–¢–†–ê–°–¢–ò üî•", "–¢—ã —É—Ç–æ–Ω—É–ª –≤ —Å–≤–æ–∏—Ö –∂–µ–ª–∞–Ω–∏—è—Ö, –∑–∞–±—ã–≤ –æ —Ç—Ä–æ–Ω–µ.");
                    return true;
                }
                return false;
            }

            endGame(title, message) {
                this.dom.modal.title.textContent = title;
                this.dom.modal.text.textContent = `${message} –¢—ã –ø—Ä–∞–≤–∏–ª ${this.gameState.turns} –ª–µ—Ç.`;
                this.dom.modal.container.classList.add('visible');
            }
        }

        window.onload = () => {
            const game = new AudioChronicleGame();
            game.startGame();
        };
    </script>
</body>
</html>
